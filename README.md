# SuppBot - BI

> SUPPBOT BI √© uma solu√ß√£o de Business Intelligence conversacional para log√≠stica, baseada em IA generativa e RAG (Retrieval-Augmented Generation). O sistema utiliza LLMs para interpretar perguntas em linguagem natural, gerar consultas SQL din√¢micas e entregar respostas precisas e contextualizadas, incluindo gr√°ficos e KPIs. Com arquitetura modular de prompts e mem√≥ria de conversa, SUPPBOT BI oferece uma interface inteligente para an√°lise avan√ßada de dados log√≠sticos via dashboard e principalmente chatbot.

## √çndice
- [SuppBot - BI](#suppbot---bi)
  - [√çndice](#√≠ndice)
  - [üõ†Ô∏è Tecnologias Usadas](#Ô∏è-tecnologias-usadas)
    - [**Geral**](#geral)
    - [**Frontend**](#frontend)
    - [**Backend**](#backend)
    - [Modelos LLM:](#modelos-llm)
  - [Estrutura do Projeto](#estrutura-do-projeto)
  - [Updates](#updates)
  - [Funcionamento](#funcionamento)
    - [`backend/app/api/dashboard.py`](#backendappapidashboardpy)

---

## üõ†Ô∏è Tecnologias Usadas

### **Geral**
- [Node.js](https://nodejs.org/) (**18.3.1**)
- [npm](https://www.npmjs.com/) 
- [Python](https://www.python.org/) (**3.12**)
- [PostgreSQL](https://www.postgresql.org/) 
- [Git](https://git-scm.com/)

---

### **Frontend**
O frontend foi criado com **React** e utiliza:  
- `react-router-dom` (navega√ß√£o entre p√°ginas)  
- `axios` (requisi√ß√µes HTTP)  
- `recharts` (gr√°ficos e visualiza√ß√µes)  
- `react-icons` (√≠cones)  
- `uuid` (gera√ß√£o de IDs)  
- `react-scripts` (scripts de build e desenvolvimento)  

---

### **Backend**
O backend foi constru√≠do com **FastAPI** + **LangChain**, incluindo:  
- `fastapi` (API backend)  
- `uvicorn` (servidor ASGI)  
- `sqlalchemy` + `psycopg2-binary` (integra√ß√£o com PostgreSQL)  
- `langchain`, `langchain-core`, `langchain-community`, `langchain-groq` (IA e LLMs)  
- `requests` / `httpx` (requisi√ß√µes HTTP)  
- `pydantic` (valida√ß√£o de dados)  
- `faker` (dados de teste)  

### Modelos LLM:
-  `llama-3.3-70b-versatile` - Para gera√ß√£o das queries
-  `llama-3.1-8b-instant` - Para as respostas amig√°veis

---

## Estrutura do Projeto

```
‚îú‚îÄ‚îÄ üìÅ backend/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üêç dashboard.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ chains/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üêç sql_rag_chain.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üêç config.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üêç database.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üêç llm.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ prompts/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üêç sql_prompts.py
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ venv
‚îÇ   ‚îú‚îÄ‚îÄ üîí .env
‚îÇ   ‚îú‚îÄ‚îÄ üêç api.py
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ testes.txt
‚îú‚îÄ‚îÄ üìÅ db_scripts/
‚îÇ   ‚îú‚îÄ‚îÄ üêç criar_tabelas.py
‚îÇ   ‚îî‚îÄ‚îÄ üêç popular_tabelas.py
‚îú‚îÄ‚îÄ üìÅ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ public/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üñºÔ∏è favicon.ico
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üåê index.html
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üñºÔ∏è logo192.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üñºÔ∏è logo512.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ manifest.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ robots.txt
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ ChartComponent.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üé® ChatMessage.css
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ ChatMessage.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üé® Navbar.css
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ Navbar.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üé® Chat.css
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Chat.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üé® Dashboard.css
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ Dashboard.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üé® App.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ App.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üé® index.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ index.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ reportWebVitals.js
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ package-lock.json
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ package.json
‚îú‚îÄ‚îÄ üìÑ .gitattributes
‚îú‚îÄ‚îÄ üö´ .gitignore
‚îî‚îÄ‚îÄ üìñ README.md
```

## Updates

> [!NOTE]
> Vers√£o 1

| Vers√£o | Data       | Mudan√ßas principais               |
|--------|------------|-----------------------------------|
| 1.0    | 25/09/2025 | MVP funcional do SUPPBOT BI       |

---

## Funcionamento

Nesta se√ß√£o, apresentamos uma vis√£o detalhada de como cada parte do SUPPBOT BI opera, do frontend ao backend. Aqui voc√™ encontrar√° uma explica√ß√£o clara de como os componentes, scripts e m√≥dulos interagem entre si, como os dados fluem do usu√°rio at√© o banco de dados e de volta, e como a intelig√™ncia artificial √© utilizada para processar perguntas, gerar consultas SQL e exibir respostas e gr√°ficos.  

O objetivo √© fornecer ao leitor uma compreens√£o completa do funcionamento interno do sistema, permitindo n√£o apenas usar o SUPPBOT BI, mas tamb√©m entender, manter e expandir seu c√≥digo com facilidade.

### `backend/app/api/dashboard.py`

> API ROUTER PARA O DASHBOARD Padr√µes de arquitetura aplicados:
> 1. Connection Pooling: Para reutilizar conex√µes com o banco de dados e melhorar a performance.
> 2. Cache: Para armazenar em mem√≥ria os resultados de queries lentas, tornando recargas r√°pidas.
> 3. Dependency Injection: Padr√£o do FastAPI para gerenciar recursos (como conex√µes) de forma segura.

<h4 style="font-size:24px;">Endpoints</h4>

<h5 style="font-size:20px;">/kpis</h5>

Retorna os principais **KPIs (Key Performance Indicators)** do dashboard log√≠stico.

**Descri√ß√£o:**  
Este endpoint consulta o banco de dados `operacoes_logisticas` e retorna m√©tricas agregadas de desempenho das opera√ß√µes log√≠sticas. Para otimizar a performance, os resultados s√£o armazenados em cache; se os dados j√° estiverem em cache, o log indicar√° `CACHE HIT` e a query n√£o ser√° executada novamente.

**Par√¢metros de entrada:**  
- Nenhum par√¢metro √© necess√°rio.  
- O endpoint depende do cursor do banco de dados (`cur`) injetado via `Depends(get_db_cursor)` no FastAPI.

**Exemplo de Request:**  
```http
GET /kpis
```

**Resposta de Sucesso (HTTP 200):**  
Um JSON com os seguintes campos:

| Campo                     | Tipo     | Descri√ß√£o                                           |
|----------------------------|---------|---------------------------------------------------|
| `total_operacoes`          | int     | N√∫mero total de opera√ß√µes registradas            |
| `operacoes_entregues`      | int     | N√∫mero de opera√ß√µes com status `ENTREGUE`        |
| `operacoes_em_transito`    | int     | N√∫mero de opera√ß√µes com status `EM_TRANSITO`     |
| `valor_total_mercadorias`  | float   | Soma do valor das mercadorias de todas as opera√ß√µes |

**Exemplo de Response:**  
```json
{
  "total_operacoes": 1200,
  "operacoes_entregues": 900,
  "operacoes_em_transito": 300,
  "valor_total_mercadorias": 157500.75
}
```

**Tratamento de Erros:**  
- Retorna `HTTP 500` com a mensagem `"Erro interno ao processar KPIs."` caso ocorra algum problema ao acessar o banco ou processar os dados.

**Observa√ß√µes:**  
- O valor de `valor_total_mercadorias` √© convertido de `Decimal` para `float` para compatibilidade com JSON.  
- Logs indicam quando os dados n√£o est√£o em cache (`CACHE MISS`) e quando s√£o servidos do cache (`CACHE HIT`).


<h5 style="font-size:20px;">/operacoes_por_status</h5>

Retorna a contagem de **opera√ß√µes log√≠sticas agrupadas por status**.

**Descri√ß√£o:**  
Este endpoint consulta o banco de dados `operacoes_logisticas` e retorna a quantidade de opera√ß√µes em cada status (`ENTREGUE`, `EM_TRANSITO`, etc.). As colunas da query j√° s√£o renomeadas para `name` e `value`, facilitando o uso direto pelo frontend. Para otimizar a performance, os resultados s√£o armazenados em cache; se os dados j√° estiverem em cache, o log indicar√° `CACHE HIT` e a query n√£o ser√° executada novamente.

**Par√¢metros de entrada:**  
- Nenhum par√¢metro √© necess√°rio.  
- O endpoint depende do cursor do banco de dados (`cur`) injetado via `Depends(get_db_cursor)` no FastAPI.

**Exemplo de Request:**  
```http
GET /operacoes_por_status
```

**Resposta de Sucesso (HTTP 200):**  
Um JSON com os seguintes campos:

| Campo   | Tipo | Descri√ß√£o                               |
|---------|------|-----------------------------------------|
| `name`  | str  | Status da opera√ß√£o (`ENTREGUE`, `EM_TRANSITO`, etc.) |
| `value` | int  | Quantidade de opera√ß√µes naquele status  |

**Exemplo de Response:**  
```json
[
  { "name": "ENTREGUE", "value": 900 },
  { "name": "EM_TRANSITO", "value": 300 },
  { "name": "PENDENTE", "value": 50 }
]
```

**Tratamento de Erros:**  
- Retorna `HTTP 500` com a mensagem `"Erro interno ao processar opera√ß√µes por status."` caso ocorra algum problema ao acessar o banco ou processar os dados.

**Observa√ß√µes:**  
- A query j√° retorna os resultados ordenados pela quantidade (`value`) em ordem decrescente.  
- Logs indicam quando os dados n√£o est√£o em cache (`CACHE MISS`) e quando s√£o servidos do cache (`CACHE HIT`).

